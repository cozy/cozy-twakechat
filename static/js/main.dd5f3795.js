(()=>{var e,t,r,n,o,i,a={57584:function(e,t,r){var n={"./en":"61284","./en.json":"61284","./fr":"51679","./fr.json":"51679"};function o(e){return r(i(e))}function i(e){if(!r.o(n,e)){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=i,e.exports=o,o.id=57584},61430:function(e,t,r){"use strict";var n=r(74848);r(7856),r(39107),r(1569);var o=r(96540),i=r(81259),a=r(42895),l=r.n(a),s=r(61122),c=r(84660),u=r(47637),d=r(60817);let f=e=>{let{client:t,lang:r,polyglot:o,children:l}=e;return(0,n.jsx)(c.WebviewIntentProvider,{children:(0,n.jsx)(a.CozyProvider,{client:t,children:(0,n.jsx)(s.DataProxyProvider,{children:(0,n.jsx)(i.BarProvider,{children:(0,n.jsx)(d.I18n,{lang:r,polyglot:o,children:(0,n.jsx)(u.BreakpointsProvider,{children:l})})})})})})};var h=r(5338),p=r(94619),g=r(4595),w=r(57771),v=JSON.parse('{"UU":"Chat","rE":"1.4.0"}');let y={};var m=r(47767),j=r(84976),x=r(91713),b=r(13572),O=r.n(b);let P=async e=>{let{orgId:t,domain:r}=e;return new URL(`https://api-login-${t}.${r}`)},k=async e=>{let{apiLoginUrl:t}=e,r=`${t.origin}/api/auth/status`,n=await fetch(r,{credentials:"include"});if(!n.ok)throw Error(`Failed auth/status fetch: ${n.status}`);let o=await n.json();return!!(o.authenticated&&o.homeserver)},S=async e=>{let{apiLoginUrl:t}=e,r=`${t.origin}/api/auth/login-url`,n=await fetch(r,{credentials:"include"});if(!n.ok)throw Error(`Failed auth/login-url fetch: ${n.status}`);return(await n.json()).loginUrl},E=async e=>{let t={definition:(0,a.Q)("io.cozy.settings").getById("instance"),options:{as:"io.cozy.settings/instance",fetchPolicy:l().fetchPolicies.olderThan(54e4),singleDocData:!0}},{data:r}=await e.query(t.definition,t.options),{org_id:n}=r;if(!n)throw Error("No org_id found in instance settings");return n},U=async e=>{let{domain:t}=await e.getInstanceOptions();if(!t)throw Error("No domain found in instance options");return t.split(".").slice(1).join(".")},_=O()("\uD83D\uDC68â€\uD83D\uDCBB [Login wrapper]"),L=async e=>{let t,r,n,o,{appUrl:i,apiLoginUrl:a}=e,l=(r=(t=new URLSearchParams(window.location.search)).get("error"),n=t.get("error_description"),o=t.get("loginToken"),{error:r,errorDescription:n,loginToken:o,homeserver:t.get("homeserver")});if(_.info("Fresh login params",l),l.error)throw Error(`Error in fresh login params: ${l.error} ${l.errorDescription}`);if((e=>{let{freshLoginParams:t}=e;return t.loginToken&&t.homeserver})({freshLoginParams:l})){let e;return _.info("\uD83D\uDD35 Fresh login"),(e=new URL(window.location.href)).searchParams.delete("loginToken"),e.searchParams.delete("homeserver"),window.history.replaceState({},"",e.toString()),(e=>{let{freshLoginParams:t,appUrl:r}=e,n=new URL("/web/auth.html",r.origin);return n.searchParams.set("loginToken",t.loginToken),n.searchParams.set("homeserver",t.homeserver),n.toString()})({freshLoginParams:l,appUrl:i})}if(_.info("\uD83D\uDD35 Not fresh login"),await k({apiLoginUrl:a}))return _.info("\uD83D\uDD35 Authenticated"),i.toString();_.info("\uD83D\uDD35 Not authenticated"),window.location.href=await S({apiLoginUrl:a})},$=e=>{let{url:t}=e,{isReady:r,urlToLoad:o}=(0,x.useExternalBridge)(t);return(0,n.jsx)("iframe",{id:"embeddedApp",src:r?o:null,allow:"clipboard-read; clipboard-write"})},R=()=>{let e=(e=>{let t=(0,a.useClient)(),[r,n]=(0,o.useState)();return(0,o.useEffect)(()=>{!async function(){let r=await E(t);_.info("Org ID:",r);let o=await U(t);_.info("Domain:",o);let i=new URL(e);_.info("App URL:",i.toString());let a=await P({orgId:r,domain:o});_.info("API login URL:",a.toString()),n(await L({appUrl:i,apiLoginUrl:a}))}()},[]),_.info("URL to load",r),r})((0,p.default)("chat.embedded-app-url"));return e?(0,n.jsx)($,{url:e}):null},T=()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.BarComponent,{searchOptions:{enabled:!1}}),(0,n.jsx)(m.sv,{})]}),N=e=>{let{Component:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t,{}),(0,n.jsx)(m.sv,{})]})},C=()=>(0,n.jsx)(j.HashRouter,{children:(0,n.jsx)(m.BV,{children:(0,n.jsx)(m.qh,{element:(0,n.jsx)(T,{}),children:(0,n.jsx)(m.qh,{path:"/",element:(0,n.jsx)(N,{Component:R}),children:(0,n.jsx)(m.qh,{path:"bridge/*"})})})})});localStorage.setItem("ui-theme-type","light");let D=()=>{var e;let t,o,i,a,s,c,u,d,m,{root:j,client:x,lang:b,polyglot:O}=(s=document.querySelector("[role=application]"),c=(0,h.createRoot)(s),u=(t=JSON.parse(s.dataset.cozy),o=window.location.protocol,i=`${o}//${t.domain}`,new(l())({uri:i,token:t.token,appMetadata:{slug:v.UU,version:v.rE},schema:y,store:!0,autoHydrate:!0})),d=(a=null==(e=JSON.parse(s.dataset.cozy))?void 0:e.locale,/^\{\{\..*\}\}$/.test(a)?"en":a),m=(0,w.i9)(d,e=>r(57584)(`./${e}`)),u.registerPlugin(p.default.plugin),u.registerPlugin(g.RealtimePlugin),{root:c,client:u,lang:d,polyglot:m});j.render((0,n.jsx)(f,{client:x,lang:b,polyglot:O,children:(0,n.jsx)(C,{})}))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",D):D()},31292:function(){},8601:function(){},11612:function(){},25785:function(){},45283:function(){},61284:function(e){"use strict";e.exports={}},51679:function(e){"use strict";e.exports={}}},l={};function s(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={id:e,loaded:!1,exports:{}};return a[e].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=a,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(r,n){if(1&n&&(r=this(r)),8&n||"object"==typeof r&&r&&(4&n&&r.__esModule||16&n&&"function"==typeof r.then))return r;var o=Object.create(null);s.r(o);var i={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>{i[e]=()=>r[e]});return i.default=()=>r,s.d(o,i),o},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r=[],s.O=(e,t,n,o)=>{if(t){o=o||0;for(var i=r.length;i>0&&r[i-1][2]>o;i--)r[i]=r[i-1];r[i]=[t,n,o];return}for(var a=1/0,i=0;i<r.length;i++){for(var[t,n,o]=r[i],l=!0,c=0;c<t.length;c++)(!1&o||a>=o)&&Object.keys(s.O).every(e=>s.O[e](t[c]))?t.splice(c--,1):(l=!1,o<a&&(a=o));if(l){r.splice(i--,1);var u=n();void 0!==u&&(e=u)}}return e},s.p="/",n={889:0},s.O.j=e=>0===n[e],o=(e,t)=>{var r,o,[i,a,l]=t,c=0;if(i.some(e=>0!==n[e])){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(l)var u=l(s)}for(e&&e(t);c<i.length;c++)o=i[c],s.o(n,o)&&n[o]&&n[o][0](),n[o]=0;return s.O(u)},(i=self.webpackChunktwakechat=self.webpackChunktwakechat||[]).forEach(o.bind(null,0)),i.push=o.bind(null,i.push.bind(i));var c=s.O(void 0,["783","535","611","534"],function(){return s(61430)});c=s.O(c)})();